{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="text-center">
        <h1>ğŸš€ Dashboard - Version 1</h1>
        <h2>Welcome, {{ current_user.username }}!</h2>
    </div>

<script>
// ì„¸ì…˜ ì •ë³´ë¥¼ Local Storageì— ì €ì¥
function updateSessionStorage() {
    fetch('/api/session-info')
        .then(response => response.json())
        .then(data => {
            // Local Storageì— ì„¸ì…˜ ì •ë³´ ì €ì¥
            localStorage.setItem('flask_session_info', JSON.stringify(data));
            localStorage.setItem('flask_session_timestamp', new Date().toISOString());
            
            alert('ğŸ”„ Session data updated in Local Storage!\n\nOpen DevTools > Application > Local Storage to view');
        })
        .catch(error => {
            console.error('Error:', error);
            alert('âŒ Failed to update session data');
        });
}

// Local Storageì˜ ì„¸ì…˜ ë°ì´í„° ë³´ê¸°
function viewSessionStorage() {
    const sessionInfo = localStorage.getItem('flask_session_info');
    const timestamp = localStorage.getItem('flask_session_timestamp');
    
    if (sessionInfo) {
        const data = JSON.parse(sessionInfo);
        const message = `ğŸ” Session Info (Updated: ${timestamp})\n\n` +
                       `User ID: ${data.user_id}\n` +
                       `Username: ${data.username}\n` +
                       `Session ID: ${data.session_id}\n` +
                       `Authenticated: ${data.is_authenticated}\n` +
                       `Fresh Login: ${data.fresh_login}\n\n` +
                       `ğŸ“Š Check DevTools > Application > Local Storage for full data`;
        alert(message);
    } else {
        alert('âš ï¸ No session data found.\nClick "Update Session Storage" first.');
    }
}

// ìë™ìœ¼ë¡œ ì„¸ì…˜ ì •ë³´ ì—…ë°ì´íŠ¸ (í˜ì´ì§€ ë¡œë“œ ì‹œ)
updateSessionStorage();

// 5ë¶„ë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸
setInterval(updateSessionStorage, 5 * 60 * 1000);
</script>
    
    <div class="info-grid">
        <div class="info-card">
            <h3>ğŸ“± Client IP</h3>
            <p>{{ client_ip }}</p>
        </div>
        <div class="info-card">
            <h3>ğŸ”„ X-Forwarded-For</h3>
            <p>{{ xff }}</p>
        </div>
        <div class="info-card">
            <h3>ğŸ–¥ï¸ Server Name</h3>
            <p>{{ server_name }}</p>
        </div>
        <div class="info-card">
            <h3>ğŸŒ Server IP</h3>
            <p>{{ server_ip }}</p>
        </div>
    </div>
    
    <div class="text-center mt-20">
        <a href="{{ url_for('board') }}" class="btn btn-primary">ğŸ“ Go to Board</a>
        <button onclick="updateSessionStorage()" class="btn btn-secondary">ğŸ”„ Update Session Storage</button>
        <button onclick="viewSessionStorage()" class="btn btn-secondary">ğŸ” View Session Data</button>
    </div>
</div>
{% endblock %}
