{% extends "base.html" %}

{% block content %}
<div class="card">
    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">← Back to Dashboard</a>
    </div>
    
    <h1>🔍 Session Debug Information</h1>
    
    <!-- 사용자 정보 -->
    <div class="card" style="margin-bottom: 20px; background: linear-gradient(45deg, #28a745, #20c997);">
        <h3 style="color: white;">👤 Current User Information</h3>
        <div style="color: white;">
            <p><strong>ID:</strong> {{ user_info.id }}</p>
            <p><strong>Username:</strong> {{ user_info.username }}</p>
            <p><strong>Is Authenticated:</strong> {{ user_info.is_authenticated }}</p>
            <p><strong>Is Active:</strong> {{ user_info.is_active }}</p>
            <p><strong>Is Anonymous:</strong> {{ user_info.is_anonymous }}</p>
        </div>
    </div>
    
    <!-- 세션 데이터 -->
    <div class="card" style="margin-bottom: 20px;">
        <h3>🔐 Session Data</h3>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; font-family: monospace;">
            {% if session_data %}
                {% for key, value in session_data.items() %}
                <div style="margin-bottom: 10px; padding: 8px; background: white; border-radius: 4px; border-left: 4px solid #667eea;">
                    <strong style="color: #667eea;">{{ key }}:</strong> 
                    <span style="color: #333;">{{ value }}</span>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: #666;">No session data available</p>
            {% endif %}
        </div>
    </div>
    
    <!-- 세션 통계 -->
    <div class="info-grid">
        <div class="info-card">
            <h3>📊 Session Stats</h3>
            <p>Total Keys: {{ session_data.keys()|length }}</p>
        </div>
        <div class="info-card">
            <h3>⏰ Current Time</h3>
            <p>{{ moment().format('YYYY-MM-DD HH:mm:ss') if moment else 'N/A' }}</p>
        </div>
        <div class="info-card">
            <h3>🌐 Session Type</h3>
            <p>Flask-Login</p>
        </div>
        <div class="info-card">
            <h3>🔄 Auto Refresh</h3>
            <p><button onclick="location.reload()" class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;">Refresh</button></p>
        </div>
    </div>
    
    <!-- 세션 관리 -->
    <div class="card" style="margin-top: 20px; text-align: center;">
        <h3>🛠️ Session Management</h3>
        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
            <a href="{{ url_for('api_session') }}" target="_blank" class="btn btn-primary">📊 View JSON API</a>
            <button onclick="copySessionData()" class="btn btn-secondary">📋 Copy Session Data</button>
            <a href="{{ url_for('logout') }}" class="btn btn-danger" onclick="return confirm('Are you sure you want to logout?')">🚪 Logout (Clear Session)</a>
        </div>
    </div>
</div>

<script>
function copySessionData() {
    const sessionText = `{{ session_data | tojson | safe }}`;
    navigator.clipboard.writeText(sessionText).then(function() {
        alert('Session data copied to clipboard!');
    }).catch(function(err) {
        console.error('Could not copy text: ', err);
        alert('Failed to copy session data');
    });
}

// 자동 새로고침 (선택사항)
// setInterval(function() {
//     location.reload();
// }, 30000); // 30초마다 새로고침
</script>
{% endblock %}
